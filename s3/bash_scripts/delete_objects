#!/usr/bin/env bash

echo "== Delete All Objects from Bucket =="

set -euo pipefail

# Script: Deletar TODOS os objetos de um bucket S3 (esvaziar o bucket)
# Uso: ./delete_objects <nome-do-bucket>
# Exemplo: ./delete_objects meu-bucket-para-esvaziar
# ‚ö†Ô∏è  AVISO: Isso REMOVE TODOS os objetos dentro do bucket, mas MANT√âM o bucket!

if [ -z "${1:-}" ]; then
    echo "‚ùå Erro: Nome do bucket n√£o informado"
    echo "Uso: $0 <nome-do-bucket>"
    echo "Exemplo: $0 meu-bucket-para-esvaziar"
    exit 1
fi

BUCKET_NAME="$1"

echo "‚ö†Ô∏è  AVISO: Voc√™ est√° prestes a DELETAR TODOS os objetos do bucket: $BUCKET_NAME"
echo "‚ùå Esta opera√ß√£o √© IRREVERS√çVEL!"
echo ""

read -p "Digite o nome do bucket para confirmar a exclus√£o de TODOS os objetos: " CONFIRM

if [ "$CONFIRM" != "$BUCKET_NAME" ]; then
    echo "‚ùå Confirma√ß√£o falhou. Opera√ß√£o cancelada."
    exit 1
fi

echo "üóëÔ∏è  Deletando todos os objetos de: s3://$BUCKET_NAME..."

if aws s3 rm "s3://$BUCKET_NAME" --recursive; then
    echo "‚úÖ Todos os objetos do bucket deletados com sucesso!"
else
    echo "‚ùå Erro ao deletar objetos do bucket"
    exit 1
fi

#!/usr/bin/env bash
set -euo pipefail

# Script: Deletar um bucket S3 inteiro
# Uso: ./delete_bucket <nome-do-bucket>
# Exemplo: ./delete_bucket meu-bucket-teste
# ‚ö†Ô∏è  AVISO: Isso REMOVE o bucket e TODO seu conte√∫do!

if [ -z "${1:-}" ]; then
    echo "‚ùå Erro: Nome do bucket n√£o informado"
    echo "Uso: $0 <nome-do-bucket>"
    echo "Exemplo: $0 meu-bucket-teste"
    exit 1
fi

BUCKET_NAME="$1"

echo "‚ö†Ô∏è  AVISO: Voc√™ est√° prestes a DELETAR o bucket: $BUCKET_NAME"
echo "‚ùå Isso vai remover TODOS os arquivos dentro dele!"
echo ""

read -p "Digite o nome do bucket para confirmar: " CONFIRM

if [ "$CONFIRM" != "$BUCKET_NAME" ]; then
    echo "‚ùå Confirma√ß√£o falhou. Opera√ß√£o cancelada."
    exit 1
fi

echo "üóëÔ∏è  Deletando bucket: $BUCKET_NAME..."

# Primeiro, remove todos os objetos do bucket
echo "Removendo objetos do bucket..."
aws s3 rm "s3://$BUCKET_NAME" --recursive 2>/dev/null || true

# Depois, remove o bucket vazio
if aws s3api delete-bucket --bucket "$BUCKET_NAME" 2>/dev/null; then
    echo "‚úÖ Bucket deletado com sucesso!"
else
    echo "‚ùå Erro ao deletar bucket"
    exit 1
fi